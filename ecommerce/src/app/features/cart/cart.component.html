
<div class="my-5 bg-gray-100 px-4">
  <h2 class="text-4xl mb-3">Shop Cart :</h2>
  @if(cartdata?.numOfCartItems){
    <p class="text-green-500 text-xl mb-2">Total Cart Price: {{cartdata?.data?.totalCartPrice}} EGP</p>
  }
  

  @for(item of cartdata?.data?.products ; track $index){ 
  <div class="flex mb-5 gap-3">
    <div class="w-1/12 ">
      <img [src]="item.product.imageCover">
    </div>
    <div class="w-11/12 flex justify-between items-center">
      <div class="space-y-1">
        <p>{{item.product.title}}</p>
        <p class="text-green-500">price : {{item.price}}</p>
        <button class=" cursor-pointer" (click)="deleteitem(item.product._id)"> 
          <i class="fa fa-trash text-green-500 fa-sm" aria-hidden="true"></i> Remove
        </button>
      </div>
      <div class="flex gap-2">
        <button class="size-8 border-2 rounded border-green-500 cursor-pointer flex justify-center items-center"
        (click)="updatecount(item.product._id, item.count+1, $index)"
        [disabled]="updateloading && currentindex==$index">
        @if(updateloading && currentindex==$index){
          <div class="flex justify-center items-center">
            <i class="fa fa-spinner text-[10px]" aria-hidden="true"></i>
          </div>
        }
        @else {
          <i class="fa fa-plus text-[10px]" aria-hidden="true"></i>
        }
          
        </button>
        <p>{{item.count}}</p>
        <button class="size-8 border-2 rounded border-green-500 cursor-pointer  flex justify-center items-center"
        (click)="updatecount(item.product._id, item.count-1, $index)"
        [disabled]="updateloading && currentindex==$index">
        @if(updateloading && currentindex==$index){
          <div class="flex justify-center items-center">
            <i class="fa fa-spinner text-[10px]" aria-hidden="true"></i>
          </div>
        }
        @else {
          <i class="fa fa-minus text-[10px]" aria-hidden="true"></i>
        }
        </button>

      </div>
    </div>
  </div>
  }
  @empty {
    <div class="flex justify-center items-center">
      <p class="text-3xl">Cart is empty</p>
    </div>
  }
  @if(cartdata?.numOfCartItems){
    <button (click)="clearcart()" class="bg-red-500 py-2 px-1 rounded text-white cursor-pointer active:scale-[98%]">Clear Cart</button>
    <button (click)="Addressform=true" class="ml-3 bg-green-500 py-2 px-1 rounded text-white cursor-pointer active:scale-[98%]">Check Out</button>

  }

  <div  [class.!flex]="Addressform" class="fixed inset-0 bg-black/70  justify-center items-center hidden">  
    <form class="max-w-3/4 w-96 mx-auto bg-white p-4" [formGroup]="addressform">
      <p class="text-3xl mb-3">Address Form</p>
      <div class="relative z-0 w-full mb-5 group mt-4">
        <input formControlName="details" type="text" name="floating_text" id="floating_text" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-green-500 focus:outline-none focus:ring-0 focus:border-green-600 peer" placeholder=" " required />
        <label for="floating_text" class="peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto peer-focus:text-green-600 peer-focus:dark:text-green-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Details</label>
      </div>
      @if(detailsController?.touched && detailsController?.invalid) {
      <div  class="p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50">
        @if(detailsController?.getError('required')){
          <p>Address is required</p>
        }
       @else if (detailsController?.getError('minlength')) {
          <p>Address must be not less than 6 characters </p>

       }
      </div>

  }
      <div class="relative z-0 w-full mb-5 group mt-4">
        <input  formControlName="city" type="text" name="floating_text" id="floating_text" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-green-500 focus:outline-none focus:ring-0 focus:border-green-600 peer" placeholder=" " required />
        <label for="floating_text" class="peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto peer-focus:text-green-600 peer-focus:dark:text-green-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">City</label>
      </div>
      @if(cityController?.touched && cityController?.invalid) {
      <div  class="p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50">
        @if(cityController?.getError('required')){
          <p>City is required</p>
        }
       @else if (cityController?.getError('pattern')) {
          <p>Please enter a valid city </p>

       }
      </div>

  }
      
      <div class="relative z-0 w-full mb-5 group mt-4">
        <input formControlName="phone" type="text" name="floating_text" id="floating_text" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-green-500 focus:outline-none focus:ring-0 focus:border-green-600 peer" placeholder=" " required />
        <label for="floating_text" class="peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto peer-focus:text-green-600 peer-focus:dark:text-green-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Phone</label>
      </div>
      @if(phoneController?.touched && phoneController?.invalid) {
      <div  class="p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50">
        @if(phoneController?.getError('required')){
          <p>Phone is required</p>
        }
       @else if (phoneController?.getError('pattern')) {
          <p>Phone number must be 11 digits and must be Egptian number</p>

       }
      </div>

  }
      <div class="flex gap-5 justify-center items-center">
        <button (click)="checkoutcash()" type="submit" class="text-white bg-green-700 hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800">Pay Cash</button>
        <button (click)="checkout()" type="submit" class="text-white bg-green-700 hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800">Pay with Visa</button>
      </div>

    </form>
  </div>

  


</div>
